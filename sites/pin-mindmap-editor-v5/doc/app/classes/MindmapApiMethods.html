<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: MindmapApiMethods</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">MindmapApiMethods</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/mindmap_module/mindmap_api_methods_rb.html">
                lib/mindmap_module/mindmap_api_methods.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000370">_change_struct</a>&nbsp;&nbsp;
      <a href="#M000358">_do_delete</a>&nbsp;&nbsp;
      <a href="#M000361">_do_image</a>&nbsp;&nbsp;
      <a href="#M000356">_do_insert</a>&nbsp;&nbsp;
      <a href="#M000363">_do_move</a>&nbsp;&nbsp;
      <a href="#M000364">_do_note</a>&nbsp;&nbsp;
      <a href="#M000362">_do_rm_image</a>&nbsp;&nbsp;
      <a href="#M000359">_do_title</a>&nbsp;&nbsp;
      <a href="#M000360">_do_toggle</a>&nbsp;&nbsp;
      <a href="#M000357">_index_valid?</a>&nbsp;&nbsp;
      <a href="#M000366">do_add_link</a>&nbsp;&nbsp;
      <a href="#M000365">do_change_color</a>&nbsp;&nbsp;
      <a href="#M000367">do_change_font_size</a>&nbsp;&nbsp;
      <a href="#M000354">do_operation</a>&nbsp;&nbsp;
      <a href="#M000368">do_set_font_bold</a>&nbsp;&nbsp;
      <a href="#M000369">do_set_font_italic</a>&nbsp;&nbsp;
      <a href="#M000355">update_or_create_note</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000370" class="method-detail">
        <a name="M000370"></a>

        <div class="method-heading">
          <a href="#M000370" class="method-signature">
          <span class="method-name">_change_struct</span><span class="method-args">() {|doc| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
保存导图结构，并保存操作历史记录
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000370-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000370-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 269</span>
269:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_change_struct</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
270:     <span class="ruby-identifier">old_struct</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct</span>.<span class="ruby-identifier">clone</span>
271:     <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct</span>)
272: 
273:     <span class="ruby-identifier">params</span> = <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">doc</span>
274: 
275:     <span class="ruby-identifier">current_revision</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-value str">&quot;Nodes&quot;</span>)[<span class="ruby-value str">&quot;revision&quot;</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
276:     <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-value str">&quot;Nodes&quot;</span>)[<span class="ruby-value str">&quot;revision&quot;</span>] = (<span class="ruby-identifier">current_revision</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">to_s</span>
277:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">to_s</span>
278: 
279:     <span class="ruby-identifier">params_hash</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:params_hash</span>]
280:     <span class="ruby-identifier">operation_kind</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:operation_kind</span>]
281: 
282:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct!</span>=<span class="ruby-identifier">old_struct</span>
283:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span>
284:       <span class="ruby-constant">HistoryRecord</span>.<span class="ruby-identifier">record_operation</span>(<span class="ruby-keyword kw">self</span>,
285:         <span class="ruby-identifier">:struct=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">old_struct</span>,
286:         <span class="ruby-identifier">:kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">operation_kind</span>,
287:         <span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params_hash</span>)
288:     <span class="ruby-keyword kw">end</span>
289:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
290:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000358" class="method-detail">
        <a name="M000358"></a>

        <div class="method-heading">
          <a href="#M000358" class="method-signature">
          <span class="method-name">_do_delete</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
删除节点
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000358-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000358-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 75</span>
75:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_delete</span>(<span class="ruby-identifier">params</span>)
76:     <span class="ruby-identifier">node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">node_id</span>
77:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
78:       <span class="ruby-identifier">node_element</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_id}']&quot;</span>)
79:       <span class="ruby-identifier">node_element</span>.<span class="ruby-identifier">remove</span>
80:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_delete&quot;</span>}
81:     <span class="ruby-keyword kw">end</span>
82:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000361" class="method-detail">
        <a name="M000361"></a>

        <div class="method-heading">
          <a href="#M000361" class="method-signature">
          <span class="method-name">_do_image</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
插入一个图片
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000361-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000361-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 120</span>
120:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_image</span>(<span class="ruby-identifier">params</span>)
121:     <span class="ruby-identifier">node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">node_id</span>
122:     <span class="ruby-identifier">url</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">image</span>.<span class="ruby-identifier">url</span>
123:     <span class="ruby-identifier">width</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">image</span>.<span class="ruby-identifier">width</span>
124:     <span class="ruby-identifier">height</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">image</span>.<span class="ruby-identifier">height</span>
125: 
126:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
127:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_id}']&quot;</span>)
128:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">'i'</span>] = <span class="ruby-identifier">url</span>
129:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">'iw'</span>] = <span class="ruby-identifier">width</span>
130:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">'ih'</span>] = <span class="ruby-identifier">height</span>
131:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_image&quot;</span>}
132:     <span class="ruby-keyword kw">end</span>
133:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000356" class="method-detail">
        <a name="M000356"></a>

        <div class="method-heading">
          <a href="#M000356" class="method-signature">
          <span class="method-name">_do_insert</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
parent 必要参数
指定一个节点的id,用来指定在哪个节点插入新节点
option[:index] 可选参数 指定节点插入到哪一个顺序位置，
默认为0，如果传入的index大于实际的parent节点下的子节点个数，取最大值
option[:title] 可选参数 指定新节点的标题 option[:id]
可选参数 指定新节点的 id 八位随机字符串
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000356-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000356-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 42</span>
42:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_insert</span>(<span class="ruby-identifier">params</span>)
43:     <span class="ruby-identifier">parent_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">parent_id</span>
44:     <span class="ruby-identifier">index</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">index</span>
45:     <span class="ruby-identifier">new_node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">new_node_id</span>
46:     <span class="ruby-identifier">title</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">title</span>
47: 
48:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
49: 
50:       <span class="ruby-identifier">parent</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N##{parent_id}&quot;</span>)
51: 
52:       <span class="ruby-identifier">node</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span><span class="ruby-operator">::</span><span class="ruby-constant">Node</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'N'</span>,<span class="ruby-identifier">doc</span>)
53:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;id&quot;</span>] = <span class="ruby-identifier">new_node_id</span>
54:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;t&quot;</span>] = <span class="ruby-identifier">title</span>
55:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;f&quot;</span>] = <span class="ruby-value str">&quot;0&quot;</span>
56: 
57:       <span class="ruby-identifier">children</span> = <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-value str">&quot;N&quot;</span>)
58: 
59:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">_index_valid?</span>(<span class="ruby-identifier">index</span>,<span class="ruby-identifier">children</span>.<span class="ruby-identifier">count</span>)
60:         <span class="ruby-identifier">next_node</span> = <span class="ruby-identifier">children</span>[<span class="ruby-identifier">index</span>]
61:         <span class="ruby-identifier">next_node</span>.<span class="ruby-identifier">add_previous_sibling</span> <span class="ruby-identifier">node</span>
62:       <span class="ruby-keyword kw">else</span>
63:         <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">add_child</span> <span class="ruby-identifier">node</span>
64:       <span class="ruby-keyword kw">end</span>
65:       
66:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_insert&quot;</span>}
67:     <span class="ruby-keyword kw">end</span>
68:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000363" class="method-detail">
        <a name="M000363"></a>

        <div class="method-heading">
          <a href="#M000363" class="method-signature">
          <span class="method-name">_do_move</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
移动某个节点
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000363-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000363-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 149</span>
149:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_move</span>(<span class="ruby-identifier">params</span>)
150:     <span class="ruby-identifier">node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">node_id</span>
151:     <span class="ruby-identifier">putright</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">putright</span>
152:     <span class="ruby-identifier">index</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">index</span>
153:     <span class="ruby-identifier">parent_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">parent_id</span>
154: 
155:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
156:       <span class="ruby-identifier">root_note</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-value str">&quot;Nodes &gt; N&quot;</span>)
157:       <span class="ruby-identifier">target</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{parent_id}']&quot;</span>)
158:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_id}']&quot;</span>)
159:       <span class="ruby-identifier">node</span>.<span class="ruby-identifier">remove</span>
160: 
161:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">'pr'</span>] = <span class="ruby-identifier">putright</span>
162:       <span class="ruby-identifier">node</span>.<span class="ruby-identifier">remove_attribute</span>(<span class="ruby-value str">'pr'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root_note</span>[<span class="ruby-value str">&quot;id&quot;</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">target</span>[<span class="ruby-value str">&quot;id&quot;</span>]
163: 
164:       <span class="ruby-identifier">children</span> = <span class="ruby-identifier">target</span>.<span class="ruby-identifier">xpath</span>(<span class="ruby-value str">&quot;N&quot;</span>)
165: 
166:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">children</span>.<span class="ruby-identifier">count</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span><span class="ruby-operator">&lt;</span><span class="ruby-identifier">children</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">!=</span> <span class="ruby-value">-1</span>
167:         <span class="ruby-identifier">next_node</span> = <span class="ruby-identifier">children</span>[<span class="ruby-identifier">index</span>]
168:         <span class="ruby-identifier">next_node</span>.<span class="ruby-identifier">add_previous_sibling</span> <span class="ruby-identifier">node</span>
169:       <span class="ruby-keyword kw">else</span>
170:         <span class="ruby-identifier">target</span>.<span class="ruby-identifier">add_child</span> <span class="ruby-identifier">node</span>
171:       <span class="ruby-keyword kw">end</span>
172:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_move&quot;</span>}
173:     <span class="ruby-keyword kw">end</span>
174:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000364" class="method-detail">
        <a name="M000364"></a>

        <div class="method-heading">
          <a href="#M000364" class="method-signature">
          <span class="method-name">_do_note</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
给某个节点增加备注
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000364-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000364-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 177</span>
177:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_note</span>(<span class="ruby-identifier">params</span>)
178:     <span class="ruby-identifier">node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">node_id</span>
179:     <span class="ruby-identifier">note</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">note</span>
180:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
181:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">update_or_create_note</span>(<span class="ruby-identifier">node_id</span>,<span class="ruby-identifier">note</span>)
182:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_note&quot;</span>}
183:     <span class="ruby-keyword kw">end</span>
184:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000362" class="method-detail">
        <a name="M000362"></a>

        <div class="method-heading">
          <a href="#M000362" class="method-signature">
          <span class="method-name">_do_rm_image</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
删除一个节点上的图片
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000362-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000362-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 136</span>
136:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_rm_image</span>(<span class="ruby-identifier">params</span>)
137:     <span class="ruby-identifier">node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">node_id</span>
138:     
139:      <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
140:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_id}']&quot;</span>)
141:       <span class="ruby-identifier">node</span>.<span class="ruby-identifier">remove_attribute</span>(<span class="ruby-value str">&quot;i&quot;</span>)
142:       <span class="ruby-identifier">node</span>.<span class="ruby-identifier">remove_attribute</span>(<span class="ruby-value str">&quot;iw&quot;</span>)
143:       <span class="ruby-identifier">node</span>.<span class="ruby-identifier">remove_attribute</span>(<span class="ruby-value str">&quot;ih&quot;</span>)
144:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_rm_image&quot;</span>}
145:     <span class="ruby-keyword kw">end</span>
146:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000359" class="method-detail">
        <a name="M000359"></a>

        <div class="method-heading">
          <a href="#M000359" class="method-signature">
          <span class="method-name">_do_title</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
修改节点标题
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000359-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000359-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_title</span>(<span class="ruby-identifier">params</span>)
86:     <span class="ruby-identifier">node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">node_id</span>
87:     <span class="ruby-identifier">title</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">title</span>
88:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
89:       <span class="ruby-identifier">node_element</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_id}']&quot;</span>)
90:       <span class="ruby-identifier">node_element</span>.<span class="ruby-identifier">attribute</span>(<span class="ruby-value str">'t'</span>).<span class="ruby-identifier">value</span> = <span class="ruby-identifier">title</span>
91:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>.<span class="ruby-identifier">hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_title&quot;</span>}
92:     <span class="ruby-keyword kw">end</span>
93:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000360" class="method-detail">
        <a name="M000360"></a>

        <div class="method-heading">
          <a href="#M000360" class="method-signature">
          <span class="method-name">_do_toggle</span><span class="method-args">(params)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
展开/折叠 一个节点
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000360-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000360-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 96</span>
 96:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_do_toggle</span>(<span class="ruby-identifier">params</span>)
 97:     <span class="ruby-identifier">node_id</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">node_id</span>
 98:     <span class="ruby-identifier">fold</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">fold</span>
 99: 
100:     <span class="ruby-identifier">old_struct</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct</span>.<span class="ruby-identifier">clone</span>
101:     <span class="ruby-identifier">doc</span> = <span class="ruby-constant">Nokogiri</span><span class="ruby-operator">::</span><span class="ruby-constant">XML</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct</span>)
102: 
103:     <span class="ruby-identifier">node_element</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_id}']&quot;</span>)
104:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fold</span>.<span class="ruby-identifier">blank?</span>
105:       <span class="ruby-identifier">fold_attr</span> = <span class="ruby-identifier">node_element</span>[<span class="ruby-value str">'f'</span>]
106:       <span class="ruby-identifier">fold_value</span> = <span class="ruby-identifier">fold_attr</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-value str">&quot;0&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">fold_attr</span>
107:       <span class="ruby-identifier">node_element</span>[<span class="ruby-value str">'f'</span>] = <span class="ruby-identifier">fold_value</span><span class="ruby-operator">==</span><span class="ruby-value str">'1'</span> <span class="ruby-operator">?</span> <span class="ruby-value str">'0'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'1'</span>
108:     <span class="ruby-keyword kw">else</span>
109:       <span class="ruby-identifier">node_element</span>[<span class="ruby-value str">'f'</span>] = <span class="ruby-identifier">fold</span>
110:     <span class="ruby-keyword kw">end</span>
111:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">to_s</span>
112: 
113:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">struct!</span>=<span class="ruby-identifier">old_struct</span>
114:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">save!</span>
115:     <span class="ruby-keyword kw">end</span>
116:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
117:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000357" class="method-detail">
        <a name="M000357"></a>

        <div class="method-heading">
          <a href="#M000357" class="method-signature">
          <span class="method-name">_index_valid?</span><span class="method-args">(index,children_count)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000357-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000357-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 70</span>
70:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">_index_valid?</span>(<span class="ruby-identifier">index</span>,<span class="ruby-identifier">children_count</span>)
71:     (<span class="ruby-identifier">children_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">children_count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">index</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">index</span> <span class="ruby-operator">!=</span> <span class="ruby-value">-1</span>)
72:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000366" class="method-detail">
        <a name="M000366"></a>

        <div class="method-heading">
          <a href="#M000366" class="method-signature">
          <span class="method-name">do_add_link</span><span class="method-args">(node_number,link)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
给一个节点增加链接
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000366-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000366-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 210</span>
210:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_add_link</span>(<span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">link</span>)
211:     <span class="ruby-identifier">params_hash</span> = {<span class="ruby-identifier">:node=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">:link=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">link</span>}
212:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node_number</span>.<span class="ruby-identifier">blank?</span>
213:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">link</span>.<span class="ruby-identifier">blank?</span>
214:     <span class="ruby-identifier">link</span>.<span class="ruby-identifier">strip!</span>
215:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">link</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">%r{^(https?://)[^\s&lt;]+$}</span>
216: 
217:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
218:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_number}']&quot;</span>)
219:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;link&quot;</span>] = <span class="ruby-identifier">link</span>
220:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params_hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_add_link&quot;</span>}
221:     <span class="ruby-keyword kw">end</span>
222:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000365" class="method-detail">
        <a name="M000365"></a>

        <div class="method-heading">
          <a href="#M000365" class="method-signature">
          <span class="method-name">do_change_color</span><span class="method-args">(node_number,option)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
修改一个节点的颜色
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000365-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000365-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 187</span>
187:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_change_color</span>(<span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">option</span>)
188:     <span class="ruby-identifier">params_hash</span> = <span class="ruby-identifier">option</span>.<span class="ruby-identifier">merge</span>({<span class="ruby-identifier">:node=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">node_number</span>})
189:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node_number</span>.<span class="ruby-identifier">blank?</span>
190: 
191:     <span class="ruby-identifier">bgc</span> = <span class="ruby-identifier">option</span>[<span class="ruby-identifier">:bgc</span>]
192:     <span class="ruby-identifier">fgc</span> = <span class="ruby-identifier">option</span>[<span class="ruby-identifier">:fgc</span>]
193: 
194:     <span class="ruby-identifier">bgc</span>.<span class="ruby-identifier">strip!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bgc</span>
195:     <span class="ruby-identifier">fgc</span>.<span class="ruby-identifier">strip!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fgc</span>
196: 
197:     <span class="ruby-comment cmt"># 验证 bgc 和 fgc 的格式</span>
198:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bgc</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-regexp re">/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">bgc</span>)
199:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fgc</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-regexp re">/^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">fgc</span>)
200: 
201:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
202:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_number}']&quot;</span>)
203:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;bgc&quot;</span>] = <span class="ruby-identifier">bgc</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bgc</span>
204:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;fgc&quot;</span>] = <span class="ruby-identifier">fgc</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fgc</span>
205:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params_hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_change_color&quot;</span>}
206:     <span class="ruby-keyword kw">end</span>
207:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000367" class="method-detail">
        <a name="M000367"></a>

        <div class="method-heading">
          <a href="#M000367" class="method-signature">
          <span class="method-name">do_change_font_size</span><span class="method-args">(node_number,size)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
修改一个节点的字体大小
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000367-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000367-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 225</span>
225:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_change_font_size</span>(<span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">size</span>)
226:     <span class="ruby-identifier">params_hash</span> = {<span class="ruby-identifier">:node=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">:fs=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">size</span>}
227:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node_number</span>.<span class="ruby-identifier">blank?</span>
228:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">size</span>.<span class="ruby-identifier">blank?</span>
229: 
230:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
231:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_number}']&quot;</span>)
232:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;fs&quot;</span>] = <span class="ruby-node">&quot;#{size}&quot;</span>
233:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params_hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_change_font_size&quot;</span>}
234:     <span class="ruby-keyword kw">end</span>
235:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000354" class="method-detail">
        <a name="M000354"></a>

        <div class="method-heading">
          <a href="#M000354" class="method-signature">
          <span class="method-name">do_operation</span><span class="method-args">(oper)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
进行修改操作
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000354-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000354-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 3</span>
 3:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_operation</span>(<span class="ruby-identifier">oper</span>)
 4:     <span class="ruby-identifier">option</span> = <span class="ruby-constant">MindmapApiOption</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">oper</span>)
 5:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">option</span>.<span class="ruby-identifier">operation</span>
 6:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_insert'</span> <span class="ruby-keyword kw">then</span>
 7:       <span class="ruby-identifier">_do_insert</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
 8:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_delete'</span> <span class="ruby-keyword kw">then</span>
 9:       <span class="ruby-identifier">_do_delete</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
10:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_title'</span> <span class="ruby-keyword kw">then</span>
11:       <span class="ruby-identifier">_do_title</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
12:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_toggle'</span> <span class="ruby-keyword kw">then</span>
13:       <span class="ruby-identifier">_do_toggle</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
14:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_image'</span> <span class="ruby-keyword kw">then</span>
15:       <span class="ruby-identifier">_do_image</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
16:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_rm_image'</span> <span class="ruby-keyword kw">then</span>
17:       <span class="ruby-identifier">_do_rm_image</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
18:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_note'</span> <span class="ruby-keyword kw">then</span>
19:       <span class="ruby-identifier">_do_note</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
20:     <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'do_move'</span> <span class="ruby-keyword kw">then</span>
21:       <span class="ruby-identifier">_do_move</span>(<span class="ruby-identifier">option</span>.<span class="ruby-identifier">params</span>)
22:     <span class="ruby-keyword kw">end</span>
23:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000368" class="method-detail">
        <a name="M000368"></a>

        <div class="method-heading">
          <a href="#M000368" class="method-signature">
          <span class="method-name">do_set_font_bold</span><span class="method-args">(node_number,bold)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
修改节点文字是否为粗体字
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000368-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000368-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 238</span>
238:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_set_font_bold</span>(<span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">bold</span>)
239:     <span class="ruby-identifier">params_hash</span> = {<span class="ruby-identifier">:node=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">:bold=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">bold</span>}
240:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node_number</span>.<span class="ruby-identifier">blank?</span>
241:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bold</span>.<span class="ruby-identifier">blank?</span>
242:     <span class="ruby-identifier">fb</span> = <span class="ruby-value str">&quot;1&quot;</span>
243:     <span class="ruby-identifier">fb</span> = <span class="ruby-value str">&quot;0&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bold</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;false&quot;</span>
244: 
245:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
246:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_number}']&quot;</span>)
247:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;fb&quot;</span>] = <span class="ruby-identifier">fb</span>
248:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params_hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_set_font_bold&quot;</span>}
249:     <span class="ruby-keyword kw">end</span>
250:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000369" class="method-detail">
        <a name="M000369"></a>

        <div class="method-heading">
          <a href="#M000369" class="method-signature">
          <span class="method-name">do_set_font_italic</span><span class="method-args">(node_number,italic)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
修改节点文字是否为斜体字
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000369-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000369-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 253</span>
253:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_set_font_italic</span>(<span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">italic</span>)
254:     <span class="ruby-identifier">params_hash</span> = {<span class="ruby-identifier">:node=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">node_number</span>,<span class="ruby-identifier">:italic=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">italic</span>}
255:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">node_number</span>.<span class="ruby-identifier">blank?</span>
256:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">italic</span>.<span class="ruby-identifier">blank?</span>
257: 
258:     <span class="ruby-identifier">fi</span> = <span class="ruby-value str">&quot;1&quot;</span>
259:     <span class="ruby-identifier">fi</span> = <span class="ruby-value str">&quot;0&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">italic</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;false&quot;</span>
260: 
261:     <span class="ruby-identifier">_change_struct</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">doc</span><span class="ruby-operator">|</span>
262:       <span class="ruby-identifier">node</span> = <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">at_css</span>(<span class="ruby-node">&quot;N[id='#{node_number}']&quot;</span>)
263:       <span class="ruby-identifier">node</span>[<span class="ruby-value str">&quot;fi&quot;</span>] = <span class="ruby-identifier">fi</span>
264:       {<span class="ruby-identifier">:params_hash=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params_hash</span>,<span class="ruby-identifier">:operation_kind=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;do_set_font_italic&quot;</span>}
265:     <span class="ruby-keyword kw">end</span>
266:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000355" class="method-detail">
        <a name="M000355"></a>

        <div class="method-heading">
          <a href="#M000355" class="method-signature">
          <span class="method-name">update_or_create_note</span><span class="method-args">(local_id,note)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000355-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000355-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mindmap_module/mindmap_api_methods.rb, line 25</span>
25:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_or_create_note</span>(<span class="ruby-identifier">local_id</span>,<span class="ruby-identifier">note</span>)
26:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">note!</span>=<span class="ruby-value str">''</span><span class="ruby-operator">&amp;&amp;</span><span class="ruby-identifier">note!</span>=<span class="ruby-value str">'&lt;br&gt;'</span>
27:       <span class="ruby-comment cmt"># 创建或者更新</span>
28:       <span class="ruby-identifier">update_node_note</span>(<span class="ruby-identifier">local_id</span>,<span class="ruby-identifier">note</span>)
29:     <span class="ruby-keyword kw">else</span>
30:       <span class="ruby-comment cmt"># 删除</span>
31:       <span class="ruby-identifier">destroy_node_note</span>(<span class="ruby-identifier">local_id</span>)
32:     <span class="ruby-keyword kw">end</span>
33:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>