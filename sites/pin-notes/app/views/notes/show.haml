-require_css 'notes'

.secondary
  .top-bar.clearfix
    %h3 版本列表
  .revisions
    %ul
      -@note.commits.each do |commit|
        %li
          =show_commit @note,commit

  =hr

  .top-bar.clearfix
    %h3 完整版本列表
  .revisions
    %ul
      -@note.ref_commits.each do |commit|
        %li
          =show_commit @note,commit

.main
  .repo
    .title
      %h3="#{@note.id}号资料"
      .actions
        -if @can_edit
          =minibutton "编辑",edit_note_path(@note)
        =minibutton "下载",note_commit_download_path(:note_id=>@note,:commit_id=>@commit_id)
        -if logged_in?
          -if current_user.star_note?(@note)
            =minibutton "去星标","/unstar/#{@note.id}",:method=>:delete
          -else
            =minibutton "加星标","/star/#{@note.id}",:method=>:post
        -if @can_edit
          =minibutton "上传文件","/upload_page/#{@note.id}"
        -if @can_rollback
          =minibutton "回滚到此版本","/notes/#{@note.id}/rollback/#{@commit_id}",:method=>:put,:confirm=>'确实要回滚到这个版本吗？'
        -if @can_fork
          =minibutton "FORK","/notes/#{@note.id}/fork",:method=>:post

      .icon
        =@note.private? ? "私有" : "公开"
    .revision_id.loud
      -if @can_edit
        最新版本
      -else
        版本号 #{@commit_id}
    .meta
      %dl
        %dt 资料描述
        %dd=@note.description
      %dl
        %dt URL
        %dd=pin_url_for('pin-notes',url_for(@note))
  .files-list
    -@blobs.each do |blob|
      -name = blob.basename
      -text = blob.data
      -mime_type = blob.mime_type
      .notefile{:id=>name}
        .meta
          %span.loud=name
          %span.quiet="(#{mime_type})"
          =link_to '#',"##{name}"
          .fright
            .embed
              -link_id = randstr
              =link_to '小组件','javascript:;',:onclick=>"jQuery('##{link_id}').hide().next().show();",:class=>'embed-link',:id=>link_id
              .embed-box{:style=>'display:none;'}
                %input{:value=>"<script src='#{pin_url_for('pin-notes',"/notes/#{@note.id}.js?file=#{name}")}'></script>"}
        .data
          =show_blob(@note,blob)

  .comments
    -if !@comments.blank?
      %h3
        #{@comments.count} 条评论
    -mplist @comments,:for=>Comment

  .comment-form
    -mindpin_form_for [@note,Comment.new] do |f|
      =f.text_area :content
      =f.submit '增加评论'

